---
import BaseLayout from "@/layouts/BaseLayout.astro";
import Section from "@/components/ui/Section.astro";
import Button from "@/components/ui/Button.astro";
import { container } from "@/container";
import { SITE } from "@/shared/config/site";

const products = await container.productRepository.getAll();
const featured = products.filter((p) => p.featured);
const all = products; // Or filter out featured if desired, but "All" usually implies everything.

const title = `Catálogo | ${SITE.name}`;
const description =
  "Catálogo de produtos e serviços da Casa Nacoli em Lajeado/RS. Personalizados, impressos e design.";
---

<BaseLayout title={title} description={description} canonicalPath="/catalogo">
  <Section class="pt-24 md:pt-32">
    <div class="text-center">
      <h1 class="text-4xl font-bold tracking-tight text-[var(--cn-ink)] md:text-5xl">Catálogo</h1>
      <p class="mx-auto mt-4 max-w-2xl text-lg text-black/70">
        Produtos e serviços feitos com cuidado artesanal. Selecione um item para ver detalhes e
        pedir seu orçamento.
      </p>
    </div>
  </Section>

  {
    featured.length > 0 && (
      <Section>
        <h2 class="text-2xl font-semibold tracking-tight text-[var(--cn-ink)]">Destaques</h2>
        <div class="mt-6 grid gap-8 sm:grid-cols-2 lg:grid-cols-3">
          {featured.map((p) => (
            <a
              href={`/catalogo/${p.slug}`}
              class="group flex flex-col overflow-hidden rounded-2xl border border-black/5 bg-white transition-all hover:-translate-y-1 hover:border-[var(--cn-ink)]/20 hover:shadow-md"
            >
              <div class="aspect-square w-full bg-[var(--cn-cream)]">
                {p.coverImage ? (
                  <img src={p.coverImage} alt={p.title} class="h-full w-full object-cover" />
                ) : (
                  <div class="flex h-full w-full items-center justify-center text-black/20">
                    Sem imagem
                  </div>
                )}
              </div>
              <div class="flex flex-1 flex-col p-6">
                <h3 class="text-lg font-semibold text-[var(--cn-ink)]">{p.title}</h3>
                <p class="mt-2 text-sm leading-relaxed text-black/70 line-clamp-2">{p.summary}</p>
                <div class="mt-auto pt-4 text-sm font-medium text-[var(--cn-terracotta)] group-hover:underline">
                  Ver detalhes
                </div>
              </div>
            </a>
          ))}
        </div>
      </Section>
    )
  }

  <Section class={featured.length ? "pt-0" : ""}>
    <h2 class="text-2xl font-semibold tracking-tight text-[var(--cn-ink)]">Todos os produtos</h2>
    <div class="mt-6 grid gap-8 sm:grid-cols-2 lg:grid-cols-3">
      {
        all.map((p) => (
          <a
            href={`/catalogo/${p.slug}`}
            class="group flex flex-col overflow-hidden rounded-2xl border border-black/5 bg-white transition-all hover:border-[var(--cn-ink)]/20 hover:shadow-sm"
          >
            <div class="aspect-[4/3] w-full bg-[var(--cn-cream)]">
              {p.coverImage ? (
                <img src={p.coverImage} alt={p.title} class="h-full w-full object-cover" />
              ) : (
                <div class="flex h-full w-full items-center justify-center text-black/20">
                  Sem imagem
                </div>
              )}
            </div>
            <div class="flex flex-1 flex-col p-5">
              <h3 class="font-semibold text-[var(--cn-ink)]">{p.title}</h3>
              <p class="mt-1 text-sm text-black/70 line-clamp-2">{p.summary}</p>
            </div>
          </a>
        ))
      }
    </div>
  </Section>

  <Section theme="cream" class="text-center">
    <h2 class="text-2xl font-semibold">Não encontrou o que procurava?</h2>
    <p class="mt-4 text-black/70">
      Trabalhamos com projetos especiais sob medida. Entre em contato e conte sua ideia.
    </p>
    <div class="mt-8">
      <Button href="/contato" variant="outline">Fale conosco</Button>
    </div>
  </Section>
</BaseLayout>
