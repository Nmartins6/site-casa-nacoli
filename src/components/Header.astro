---
import Button from "@/components/ui/Button.astro";
import { SITE } from "@/shared/config/site";

const nav = [
  { href: import.meta.env.BASE_URL, label: "Início" },
  { href: `${import.meta.env.BASE_URL.replace(/\/$/, "")}/catalogo`, label: "Catálogo" },
  { href: `${import.meta.env.BASE_URL.replace(/\/$/, "")}/sobre`, label: "Sobre" },
  { href: `${import.meta.env.BASE_URL.replace(/\/$/, "")}/portfolio`, label: "Portfólio" },
  { href: `${import.meta.env.BASE_URL.replace(/\/$/, "")}/contato`, label: "Contato" },
];
---

<header class="sticky top-0 z-50 border-b border-black/5 bg-[var(--cn-cream)] shadow-lg">
  <div class="mx-auto flex h-16 max-w-7xl items-center justify-between px-4 sm:px-6 lg:px-8">
    <a href={import.meta.env.BASE_URL} class="flex items-center gap-3">
      <div class="size-10 overflow-hidden rounded-xl bg-white/60 ring-1 ring-black/5">
        <img
          src={`${import.meta.env.BASE_URL.replace(/\/$/, "")}/images/brand/logo.webp`}
          alt="Logo Casa Nacoli"
          class="h-full w-full object-cover"
        />
      </div>
      <div class="leading-tight">
        <div class="text-sm font-semibold tracking-tight text-[var(--cn-ink)]">{SITE.name}</div>
        <div class="hidden text-xs text-black/60 sm:block">gráfica artesanal independente</div>
      </div>
    </a>

    <nav class="hidden items-center gap-8 text-sm font-medium text-black/70 md:flex">
      {
        nav.map((item) => (
          <a class="transition-colors hover:text-[var(--cn-ink)]" href={item.href}>
            {item.label}
          </a>
        ))
      }
    </nav>

    <div class="flex items-center gap-2 sm:gap-4">
      <Button
        href={`${import.meta.env.BASE_URL.replace(/\/$/, "")}/contato`}
        size="sm"
        class="hidden whitespace-nowrap transition-all md:inline-flex"
      >
        Pedir orçamento
      </Button>

      <button
        id="mobile-menu-button"
        class="flex h-10 w-10 items-center justify-center rounded-lg text-black/70 hover:bg-black/5 hover:text-[var(--cn-ink)] md:hidden"
        aria-label="Menu"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="2"
          stroke="currentColor"
          class="size-6"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path>
        </svg>
      </button>
    </div>
  </div>
</header>

<div id="mobile-menu" class="fixed inset-0 z-[60] hidden md:hidden">
  <div id="mobile-menu-backdrop" class="absolute inset-0 bg-black/50 backdrop-blur-sm"></div>
  <div
    class="absolute right-0 top-0 h-full w-full max-w-xs bg-white p-6 shadow-2xl transition-transform duration-300 translate-x-full border-l border-black/5"
    id="mobile-menu-content"
  >
    <div class="flex items-center justify-between mb-8">
      <span class="text-lg font-bold text-[var(--cn-ink)]">Menu</span>
      <button id="mobile-menu-close" class="p-2 text-black/60 hover:text-[var(--cn-ink)]">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="2"
          stroke="currentColor"
          class="size-6"
        >
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <nav class="flex flex-col gap-5 text-lg font-medium text-black/70">
      {
        nav.map((item) => (
          <a
            class="border-b border-black/5 pb-2 transition-colors hover:text-[var(--cn-ink)]"
            href={item.href}
          >
            {item.label}
          </a>
        ))
      }
      <Button href={`${import.meta.env.BASE_URL.replace(/\/$/, "")}/contato`} class="mt-4">
        Pedir orçamento
      </Button>
    </nav>
  </div>
</div>

<script>
  function setupMobileMenu() {
    const button = document.getElementById("mobile-menu-button");
    const closeBtn = document.getElementById("mobile-menu-close");
    const menu = document.getElementById("mobile-menu");
    const menuContent = document.getElementById("mobile-menu-content");
    const backdrop = document.getElementById("mobile-menu-backdrop");
    const links = menu?.querySelectorAll("a");

    if (!button || !menu || !menuContent || !backdrop) return;

    // Use elements as HTMLElement to satisfy TypeScript narrowing in closures
    const m = menu as HTMLElement;
    const mc = menuContent as HTMLElement;

    const openMenu = () => {
      m.classList.remove("hidden");
      void mc.offsetHeight;
      mc.classList.remove("translate-x-full");
      document.body.style.overflow = "hidden";
    };

    const closeMenu = () => {
      mc.classList.add("translate-x-full");
      setTimeout(() => {
        m.classList.add("hidden");
        document.body.style.overflow = "";
      }, 300);
    };

    button.addEventListener("click", openMenu);
    closeBtn?.addEventListener("click", closeMenu);
    backdrop.addEventListener("click", closeMenu);
    links?.forEach((link) => link.addEventListener("click", closeMenu));
  }

  setupMobileMenu();
  document.addEventListener("astro:page-load", setupMobileMenu);
</script>
